import{_ as t,c as e,a2 as s,o as n}from"./chunks/framework.Bt53DRYp.js";const u=JSON.parse('{"title":"Storage Solutions","description":"","frontmatter":{},"headers":[],"relativePath":"hardware/storage.md","filePath":"hardware/storage.md"}'),r={name:"hardware/storage.md"};function i(o,a,l,d,p,c){return n(),e("div",null,a[0]||(a[0]=[s(`<h1 id="storage-solutions" tabindex="-1">Storage Solutions <a class="header-anchor" href="#storage-solutions" aria-label="Permalink to &quot;Storage Solutions&quot;">​</a></h1><p>This page documents the storage infrastructure in your home lab environment.</p><h2 id="storage-overview" tabindex="-1">Storage Overview <a class="header-anchor" href="#storage-overview" aria-label="Permalink to &quot;Storage Overview&quot;">​</a></h2><p>Your home lab employs a multi-tiered storage strategy with different solutions optimized for various workloads:</p><ol><li><strong>Primary Storage</strong>: TrueNAS Scale NAS with large ZFS pool</li><li><strong>Server Local Storage</strong>: NVMe and SAS drives for VM hosting</li><li><strong>Backup Storage</strong>: Dedicated backup server with large RAID array</li><li><strong>Archive Storage</strong>: External drives for cold storage</li></ol><h2 id="primary-storage-nas" tabindex="-1">Primary Storage (NAS) <a class="header-anchor" href="#primary-storage-nas" aria-label="Permalink to &quot;Primary Storage (NAS)&quot;">​</a></h2><h3 id="hardware" tabindex="-1">Hardware <a class="header-anchor" href="#hardware" aria-label="Permalink to &quot;Hardware&quot;">​</a></h3><ul><li><strong>System</strong>: Custom 4U Storage Server</li><li><strong>CPU</strong>: Intel Xeon E-2278G (8 cores, 16 threads)</li><li><strong>RAM</strong>: 64GB DDR4 ECC</li><li><strong>Boot Drives</strong>: 2 x 500GB Samsung 870 EVO SSD (ZFS mirror)</li><li><strong>Cache Drives</strong>: 2 x 1TB Samsung 980 Pro NVMe SSD (ZFS mirror)</li><li><strong>Data Drives</strong>: 12 x 16TB Seagate EXOS X16 Enterprise HDD</li><li><strong>HBA</strong>: LSI 9300-16i (IT mode)</li><li><strong>Network</strong>: 10GbE SFP+ primary, 2 x 1GbE secondary</li></ul><h3 id="zfs-configuration" tabindex="-1">ZFS Configuration <a class="header-anchor" href="#zfs-configuration" aria-label="Permalink to &quot;ZFS Configuration&quot;">​</a></h3><h4 id="pool-layout" tabindex="-1">Pool Layout <a class="header-anchor" href="#pool-layout" aria-label="Permalink to &quot;Pool Layout&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>main-pool (RAIDZ2)</span></span>
<span class="line"><span>├── 12 x 16TB HDDs</span></span>
<span class="line"><span>│   ├── 192TB raw capacity</span></span>
<span class="line"><span>│   └── 160TB usable capacity</span></span></code></pre></div><h4 id="dataset-structure" tabindex="-1">Dataset Structure <a class="header-anchor" href="#dataset-structure" aria-label="Permalink to &quot;Dataset Structure&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>main-pool/</span></span>
<span class="line"><span>├── media/</span></span>
<span class="line"><span>│   ├── movies/</span></span>
<span class="line"><span>│   ├── tv/</span></span>
<span class="line"><span>│   ├── music/</span></span>
<span class="line"><span>│   └── photos/</span></span>
<span class="line"><span>├── backups/</span></span>
<span class="line"><span>│   ├── server-backups/</span></span>
<span class="line"><span>│   ├── vm-backups/</span></span>
<span class="line"><span>│   └── client-backups/</span></span>
<span class="line"><span>├── documents/</span></span>
<span class="line"><span>│   ├── personal/</span></span>
<span class="line"><span>│   ├── financial/</span></span>
<span class="line"><span>│   └── projects/</span></span>
<span class="line"><span>├── vm-storage/</span></span>
<span class="line"><span>│   ├── main-server/</span></span>
<span class="line"><span>│   └── backup-server/</span></span>
<span class="line"><span>└── isos/</span></span></code></pre></div><h4 id="zfs-properties" tabindex="-1">ZFS Properties <a class="header-anchor" href="#zfs-properties" aria-label="Permalink to &quot;ZFS Properties&quot;">​</a></h4><table tabindex="0"><thead><tr><th>Dataset</th><th>Compression</th><th>Deduplication</th><th>Recordsize</th><th>Sync</th><th>Quota</th></tr></thead><tbody><tr><td>media</td><td>lz4</td><td>Off</td><td>1M</td><td>Standard</td><td>100TB</td></tr><tr><td>backups</td><td>zstd</td><td>Off</td><td>1M</td><td>Standard</td><td>40TB</td></tr><tr><td>documents</td><td>zstd</td><td>Off</td><td>128K</td><td>Always</td><td>5TB</td></tr><tr><td>vm-storage</td><td>lz4</td><td>Off</td><td>64K</td><td>Always</td><td>None</td></tr><tr><td>isos</td><td>lz4</td><td>Off</td><td>1M</td><td>Standard</td><td>1TB</td></tr></tbody></table><h3 id="performance-metrics" tabindex="-1">Performance Metrics <a class="header-anchor" href="#performance-metrics" aria-label="Permalink to &quot;Performance Metrics&quot;">​</a></h3><ul><li><strong>Sequential Read</strong>: 2.2 GB/s</li><li><strong>Sequential Write</strong>: 1.8 GB/s</li><li><strong>Random Read (4K)</strong>: 3,500 IOPS</li><li><strong>Random Write (4K)</strong>: 2,800 IOPS</li><li><strong>Network Throughput</strong>: 9.7 Gbps (10GbE)</li><li><strong>Typical Latency</strong>: 0.5-2ms</li></ul><h3 id="sharing-protocols" tabindex="-1">Sharing Protocols <a class="header-anchor" href="#sharing-protocols" aria-label="Permalink to &quot;Sharing Protocols&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Protocol</th><th>Purpose</th><th>Authentication</th><th>Encryption</th></tr></thead><tbody><tr><td>SMB/CIFS</td><td>Windows clients, general file sharing</td><td>Active Directory</td><td>Required</td></tr><tr><td>NFS</td><td>VM storage, Linux clients</td><td>IP-based</td><td>Not available</td></tr><tr><td>iSCSI</td><td>Block storage for servers</td><td>CHAP</td><td>Optional</td></tr><tr><td>S3</td><td>Object storage</td><td>API keys</td><td>Required</td></tr></tbody></table><h2 id="server-local-storage" tabindex="-1">Server Local Storage <a class="header-anchor" href="#server-local-storage" aria-label="Permalink to &quot;Server Local Storage&quot;">​</a></h2><h3 id="main-server" tabindex="-1">Main Server <a class="header-anchor" href="#main-server" aria-label="Permalink to &quot;Main Server&quot;">​</a></h3><ul><li><strong>Boot/OS</strong>: 2 x 1TB Samsung 980 Pro NVMe SSD (RAID 1)</li><li><strong>VM Storage</strong>: 4 x 4TB Seagate IronWolf Pro (RAID 10)</li><li><strong>Total Capacity</strong>: 1TB OS, 8TB VM storage</li><li><strong>Performance</strong>: <ul><li>NVMe: 6.5 GB/s read, 5.0 GB/s write</li><li>HDD RAID: 800 MB/s read, 750 MB/s write</li></ul></li></ul><h3 id="backup-server" tabindex="-1">Backup Server <a class="header-anchor" href="#backup-server" aria-label="Permalink to &quot;Backup Server&quot;">​</a></h3><ul><li><strong>Boot/OS</strong>: 2 x 500GB Samsung 870 EVO SSD (RAID 1)</li><li><strong>Backup Storage</strong>: 6 x 8TB WD Red Pro (RAID 6)</li><li><strong>Total Capacity</strong>: 500GB OS, 32TB backup storage</li><li><strong>Performance</strong>: <ul><li>SSD: 550 MB/s read, 520 MB/s write</li><li>HDD RAID: 700 MB/s read, 500 MB/s write</li></ul></li></ul><h2 id="storage-networking" tabindex="-1">Storage Networking <a class="header-anchor" href="#storage-networking" aria-label="Permalink to &quot;Storage Networking&quot;">​</a></h2><h3 id="network-topology" tabindex="-1">Network Topology <a class="header-anchor" href="#network-topology" aria-label="Permalink to &quot;Network Topology&quot;">​</a></h3><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph TD</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    NAS[NAS 10GbE] --- Switch[10GbE Switch]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Switch --- MainServer[Main Server 10GbE]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Switch --- BackupServer[Backup Server 10GbE]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Switch --- Router[Router 1GbE]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Router --- ClientDevices[Client Devices]</span></span></code></pre></div><h3 id="network-performance" tabindex="-1">Network Performance <a class="header-anchor" href="#network-performance" aria-label="Permalink to &quot;Network Performance&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Connection</th><th>Theoretical Max</th><th>Actual Throughput</th><th>Latency</th></tr></thead><tbody><tr><td>NAS ↔ Main Server</td><td>10 Gbps</td><td>9.7 Gbps</td><td>0.2ms</td></tr><tr><td>NAS ↔ Backup Server</td><td>10 Gbps</td><td>9.4 Gbps</td><td>0.2ms</td></tr><tr><td>NAS ↔ Client Devices</td><td>1 Gbps</td><td>940 Mbps</td><td>0.5ms</td></tr><tr><td>Main Server ↔ Backup Server</td><td>10 Gbps</td><td>9.5 Gbps</td><td>0.2ms</td></tr></tbody></table><h2 id="backup-strategy" tabindex="-1">Backup Strategy <a class="header-anchor" href="#backup-strategy" aria-label="Permalink to &quot;Backup Strategy&quot;">​</a></h2><h3 id="backup-tiers" tabindex="-1">Backup Tiers <a class="header-anchor" href="#backup-tiers" aria-label="Permalink to &quot;Backup Tiers&quot;">​</a></h3><ol><li><strong>Tier 1</strong>: Daily incremental backups to backup server</li><li><strong>Tier 2</strong>: Weekly full backups to backup server</li><li><strong>Tier 3</strong>: Monthly archives to external storage</li><li><strong>Tier 4</strong>: Quarterly offsite backups</li></ol><h3 id="backup-software" tabindex="-1">Backup Software <a class="header-anchor" href="#backup-software" aria-label="Permalink to &quot;Backup Software&quot;">​</a></h3><ul><li><strong>VM Backups</strong>: Proxmox Backup Server</li><li><strong>File Backups</strong>: Duplicati</li><li><strong>NAS Replication</strong>: TrueNAS built-in replication</li><li><strong>Client Backups</strong>: Veeam Agent</li></ul><h3 id="retention-policy" tabindex="-1">Retention Policy <a class="header-anchor" href="#retention-policy" aria-label="Permalink to &quot;Retention Policy&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Backup Type</th><th>Retention Period</th><th>Storage Location</th></tr></thead><tbody><tr><td>Daily Incrementals</td><td>14 days</td><td>Backup Server</td></tr><tr><td>Weekly Full</td><td>8 weeks</td><td>Backup Server</td></tr><tr><td>Monthly Archives</td><td>12 months</td><td>Backup Server + External</td></tr><tr><td>Quarterly Offsite</td><td>2 years</td><td>Offsite Storage</td></tr></tbody></table><h2 id="storage-monitoring" tabindex="-1">Storage Monitoring <a class="header-anchor" href="#storage-monitoring" aria-label="Permalink to &quot;Storage Monitoring&quot;">​</a></h2><h3 id="monitoring-tools" tabindex="-1">Monitoring Tools <a class="header-anchor" href="#monitoring-tools" aria-label="Permalink to &quot;Monitoring Tools&quot;">​</a></h3><ul><li><strong>SMART Monitoring</strong>: smartd on all systems</li><li><strong>ZFS Health</strong>: TrueNAS built-in monitoring</li><li><strong>Performance Metrics</strong>: Prometheus + Grafana</li><li><strong>Capacity Trending</strong>: Custom Grafana dashboard</li><li><strong>Alerts</strong>: Email + Telegram notifications</li></ul><h3 id="alert-thresholds" tabindex="-1">Alert Thresholds <a class="header-anchor" href="#alert-thresholds" aria-label="Permalink to &quot;Alert Thresholds&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Metric</th><th>Warning Threshold</th><th>Critical Threshold</th></tr></thead><tbody><tr><td>Disk Space</td><td>80%</td><td>90%</td></tr><tr><td>SMART Errors</td><td>Any</td><td>Any</td></tr><tr><td>ZFS Scrub Errors</td><td>Any</td><td>Any</td></tr><tr><td>Read/Write Latency</td><td>10ms</td><td>20ms</td></tr><tr><td>Temperature</td><td>45°C</td><td>50°C</td></tr></tbody></table><h2 id="disaster-recovery" tabindex="-1">Disaster Recovery <a class="header-anchor" href="#disaster-recovery" aria-label="Permalink to &quot;Disaster Recovery&quot;">​</a></h2><h3 id="recovery-scenarios" tabindex="-1">Recovery Scenarios <a class="header-anchor" href="#recovery-scenarios" aria-label="Permalink to &quot;Recovery Scenarios&quot;">​</a></h3><h4 id="scenario-1-single-disk-failure" tabindex="-1">Scenario 1: Single Disk Failure <a class="header-anchor" href="#scenario-1-single-disk-failure" aria-label="Permalink to &quot;Scenario 1: Single Disk Failure&quot;">​</a></h4><ol><li>ZFS will continue to operate in degraded mode</li><li>Replace failed disk</li><li>ZFS will resilver automatically</li><li>Estimated recovery time: 24-48 hours</li></ol><h4 id="scenario-2-multiple-disk-failures-beyond-redundancy" tabindex="-1">Scenario 2: Multiple Disk Failures (Beyond Redundancy) <a class="header-anchor" href="#scenario-2-multiple-disk-failures-beyond-redundancy" aria-label="Permalink to &quot;Scenario 2: Multiple Disk Failures (Beyond Redundancy)&quot;">​</a></h4><ol><li>Restore from backup server</li><li>Prioritize critical data first</li><li>Estimated recovery time: 48-72 hours</li></ol><h4 id="scenario-3-complete-nas-failure" tabindex="-1">Scenario 3: Complete NAS Failure <a class="header-anchor" href="#scenario-3-complete-nas-failure" aria-label="Permalink to &quot;Scenario 3: Complete NAS Failure&quot;">​</a></h4><ol><li>Temporary NAS can be configured on backup server</li><li>Critical services restored from backups</li><li>New hardware acquisition and setup</li><li>Estimated recovery time: 3-5 days</li></ol><h3 id="recovery-testing" tabindex="-1">Recovery Testing <a class="header-anchor" href="#recovery-testing" aria-label="Permalink to &quot;Recovery Testing&quot;">​</a></h3><ul><li>Quarterly recovery drills</li><li>Test restoration of random files</li><li>Validate VM recovery</li><li>Document recovery time and issues</li></ul><h2 id="future-expansion-plans" tabindex="-1">Future Expansion Plans <a class="header-anchor" href="#future-expansion-plans" aria-label="Permalink to &quot;Future Expansion Plans&quot;">​</a></h2><h3 id="short-term-6-12-months" tabindex="-1">Short-term (6-12 months) <a class="header-anchor" href="#short-term-6-12-months" aria-label="Permalink to &quot;Short-term (6-12 months)&quot;">​</a></h3><ul><li>Add 4 additional 16TB drives to NAS (Q4 2025)</li><li>Upgrade NAS RAM to 128GB</li><li>Implement automated tiering between NVMe and HDD</li></ul><h3 id="long-term-1-3-years" tabindex="-1">Long-term (1-3 years) <a class="header-anchor" href="#long-term-1-3-years" aria-label="Permalink to &quot;Long-term (1-3 years)&quot;">​</a></h3><ul><li>Migrate to larger capacity drives (20TB+)</li><li>Evaluate transition to all-flash for critical workloads</li><li>Implement secondary NAS for real-time replication</li></ul><h2 id="storage-performance-tuning" tabindex="-1">Storage Performance Tuning <a class="header-anchor" href="#storage-performance-tuning" aria-label="Permalink to &quot;Storage Performance Tuning&quot;">​</a></h2><h3 id="zfs-tuning-parameters" tabindex="-1">ZFS Tuning Parameters <a class="header-anchor" href="#zfs-tuning-parameters" aria-label="Permalink to &quot;ZFS Tuning Parameters&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># ARC Size Limits</span></span>
<span class="line"><span>echo &quot;options zfs zfs_arc_min=8589934592&quot; &gt;&gt; /etc/modprobe.d/zfs.conf</span></span>
<span class="line"><span>echo &quot;options zfs zfs_arc_max=34359738368&quot; &gt;&gt; /etc/modprobe.d/zfs.conf</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Prefetch Tuning</span></span>
<span class="line"><span>echo &quot;options zfs zfs_prefetch_disable=0&quot; &gt;&gt; /etc/modprobe.d/zfs.conf</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Transaction Group Timeout</span></span>
<span class="line"><span>echo &quot;options zfs zfs_txg_timeout=5&quot; &gt;&gt; /etc/modprobe.d/zfs.conf</span></span></code></pre></div><h3 id="nfs-tuning" tabindex="-1">NFS Tuning <a class="header-anchor" href="#nfs-tuning" aria-label="Permalink to &quot;NFS Tuning&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># /etc/nfs.conf</span></span>
<span class="line"><span>[nfsd]</span></span>
<span class="line"><span>threads=16</span></span>
<span class="line"><span>tcp=y</span></span>
<span class="line"><span>udp=n</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[mountd]</span></span>
<span class="line"><span>manage-gids=y</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[statd]</span></span>
<span class="line"><span>port=32765</span></span>
<span class="line"><span>outgoing-port=32766</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[lockd]</span></span>
<span class="line"><span>port=32768</span></span>
<span class="line"><span>udp-port=32768</span></span></code></pre></div><h3 id="smb-tuning" tabindex="-1">SMB Tuning <a class="header-anchor" href="#smb-tuning" aria-label="Permalink to &quot;SMB Tuning&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># /etc/samba/smb.conf</span></span>
<span class="line"><span>[global]</span></span>
<span class="line"><span>socket options = TCP_NODELAY IPTOS_LOWDELAY SO_RCVBUF=131072 SO_SNDBUF=131072</span></span>
<span class="line"><span>read raw = yes</span></span>
<span class="line"><span>write raw = yes</span></span>
<span class="line"><span>server min protocol = SMB2</span></span>
<span class="line"><span>server max protocol = SMB3</span></span>
<span class="line"><span>min receivefile size = 16384</span></span>
<span class="line"><span>aio read size = 1</span></span>
<span class="line"><span>aio write size = 1</span></span>
<span class="line"><span>use sendfile = yes</span></span></code></pre></div><h2 id="storage-maintenance-schedule" tabindex="-1">Storage Maintenance Schedule <a class="header-anchor" href="#storage-maintenance-schedule" aria-label="Permalink to &quot;Storage Maintenance Schedule&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Task</th><th>Frequency</th><th>Duration</th><th>Impact</th></tr></thead><tbody><tr><td>ZFS Scrub</td><td>Monthly</td><td>24-36 hours</td><td>Minimal</td></tr><tr><td>SMART Extended Tests</td><td>Monthly</td><td>8-12 hours</td><td>None</td></tr><tr><td>Filesystem Cleanup</td><td>Quarterly</td><td>2-4 hours</td><td>None</td></tr><tr><td>Firmware Updates</td><td>As needed</td><td>1-2 hours</td><td>Downtime</td></tr><tr><td>Performance Analysis</td><td>Quarterly</td><td>2 hours</td><td>None</td></tr><tr><td>Capacity Planning</td><td>Quarterly</td><td>1 hour</td><td>None</td></tr></tbody></table>`,65)]))}const g=t(r,[["render",i]]);export{u as __pageData,g as default};
